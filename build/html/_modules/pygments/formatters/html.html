

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pygments.formatters.html &mdash; pygments-doc 1.1.3 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.1.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="pygments-doc 1.1.3 documentation" href="../../../index.html" />
    <link rel="up" title="pygments.formatters" href="../formatters.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">pygments-doc 1.1.3 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../pygments.html" >pygments</a> &raquo;</li>
          <li><a href="../formatters.html" accesskey="U">pygments.formatters</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pygments.formatters.html</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pygments.formatters.html</span>
<span class="sd">    ~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="sd">    Formatter for HTML output.</span>

<span class="sd">    :copyright: Copyright 2006-2013 by the Pygments team, see AUTHORS.</span>
<span class="sd">    :license: BSD, see LICENSE for details.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">StringIO</span>

<span class="kn">from</span> <span class="nn">pygments.formatter</span> <span class="kn">import</span> <span class="n">Formatter</span>
<span class="kn">from</span> <span class="nn">pygments.token</span> <span class="kn">import</span> <span class="n">Token</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">STANDARD_TYPES</span>
<span class="kn">from</span> <span class="nn">pygments.util</span> <span class="kn">import</span> <span class="n">get_bool_opt</span><span class="p">,</span> <span class="n">get_int_opt</span><span class="p">,</span> <span class="n">get_list_opt</span><span class="p">,</span> <span class="nb">bytes</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">ctags</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">ctags</span> <span class="o">=</span> <span class="bp">None</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;HtmlFormatter&#39;</span><span class="p">]</span>


<span class="n">_escape_html_table</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;&amp;&#39;</span><span class="p">):</span> <span class="s">u&#39;&amp;amp;&#39;</span><span class="p">,</span>
    <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;&lt;&#39;</span><span class="p">):</span> <span class="s">u&#39;&amp;lt;&#39;</span><span class="p">,</span>
    <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">):</span> <span class="s">u&#39;&amp;gt;&#39;</span><span class="p">,</span>
    <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">):</span> <span class="s">u&#39;&amp;quot;&#39;</span><span class="p">,</span>
    <span class="nb">ord</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">):</span> <span class="s">u&#39;&amp;#39;&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">escape_html</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="n">_escape_html_table</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Escape &amp;, &lt;, &gt; as well as single and double quotes for HTML.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_random_id</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Return a random id for javascript fields.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span>
    <span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">sha1</span> <span class="k">as</span> <span class="n">sha</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">sha</span>
        <span class="n">sha</span> <span class="o">=</span> <span class="n">sha</span><span class="o">.</span><span class="n">new</span>
    <span class="k">return</span> <span class="n">sha</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">|</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">random</span><span class="p">(),</span> <span class="n">time</span><span class="p">()))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_get_ttype_class</span><span class="p">(</span><span class="n">ttype</span><span class="p">):</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="n">STANDARD_TYPES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ttype</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fname</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fname</span>
    <span class="n">aname</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">while</span> <span class="n">fname</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">aname</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="n">ttype</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">aname</span>
        <span class="n">ttype</span> <span class="o">=</span> <span class="n">ttype</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">STANDARD_TYPES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ttype</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fname</span> <span class="o">+</span> <span class="n">aname</span>


<span class="n">CSSFILE_TEMPLATE</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">td.linenos { background-color: #f0f0f0; padding-right: 10px; }</span>
<span class="s">span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }</span>
<span class="s">pre { line-height: 125</span><span class="si">%%</span><span class="s">; }</span>
<span class="si">%(styledefs)s</span><span class="s"></span>
<span class="s">&#39;&#39;&#39;</span>

<span class="n">DOC_HEADER</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot;</span>
<span class="s">   &quot;http://www.w3.org/TR/html4/strict.dtd&quot;&gt;</span>

<span class="s">&lt;html&gt;</span>
<span class="s">&lt;head&gt;</span>
<span class="s">  &lt;title&gt;</span><span class="si">%(title)s</span><span class="s">&lt;/title&gt;</span>
<span class="s">  &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=</span><span class="si">%(encoding)s</span><span class="s">&quot;&gt;</span>
<span class="s">  &lt;style type=&quot;text/css&quot;&gt;</span>
<span class="s">&#39;&#39;&#39;</span> <span class="o">+</span> <span class="n">CSSFILE_TEMPLATE</span> <span class="o">+</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">  &lt;/style&gt;</span>
<span class="s">&lt;/head&gt;</span>
<span class="s">&lt;body&gt;</span>
<span class="s">&lt;h2&gt;</span><span class="si">%(title)s</span><span class="s">&lt;/h2&gt;</span>

<span class="s">&#39;&#39;&#39;</span>

<span class="n">DOC_HEADER_EXTERNALCSS</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot;</span>
<span class="s">   &quot;http://www.w3.org/TR/html4/strict.dtd&quot;&gt;</span>

<span class="s">&lt;html&gt;</span>
<span class="s">&lt;head&gt;</span>
<span class="s">  &lt;title&gt;</span><span class="si">%(title)s</span><span class="s">&lt;/title&gt;</span>
<span class="s">  &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=</span><span class="si">%(encoding)s</span><span class="s">&quot;&gt;</span>
<span class="s">  &lt;link rel=&quot;stylesheet&quot; href=&quot;</span><span class="si">%(cssfile)s</span><span class="s">&quot; type=&quot;text/css&quot;&gt;</span>
<span class="s">&lt;/head&gt;</span>
<span class="s">&lt;body&gt;</span>
<span class="s">&lt;h2&gt;</span><span class="si">%(title)s</span><span class="s">&lt;/h2&gt;</span>

<span class="s">&#39;&#39;&#39;</span>

<span class="n">DOC_FOOTER</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">&lt;/body&gt;</span>
<span class="s">&lt;/html&gt;</span>
<span class="s">&#39;&#39;&#39;</span>


<div class="viewcode-block" id="HtmlFormatter"><a class="viewcode-back" href="../../../formatters/html.html#pygments.formatters.html.HtmlFormatter">[docs]</a><span class="k">class</span> <span class="nc">HtmlFormatter</span><span class="p">(</span><span class="n">Formatter</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Format tokens as HTML 4 ``&lt;span&gt;`` tags within a ``&lt;pre&gt;`` tag, wrapped</span>
<span class="sd">    in a ``&lt;div&gt;`` tag. The ``&lt;div&gt;``&#39;s CSS class can be set by the `cssclass`</span>
<span class="sd">    option.</span>

<span class="sd">    If the `linenos` option is set to ``&quot;table&quot;``, the ``&lt;pre&gt;`` is</span>
<span class="sd">    additionally wrapped inside a ``&lt;table&gt;`` which has one row and two</span>
<span class="sd">    cells: one containing the line numbers and one containing the code.</span>
<span class="sd">    Example:</span>

<span class="sd">    .. sourcecode:: html</span>

<span class="sd">        &lt;div class=&quot;highlight&quot; &gt;</span>
<span class="sd">        &lt;table&gt;&lt;tr&gt;</span>
<span class="sd">          &lt;td class=&quot;linenos&quot; title=&quot;click to toggle&quot;</span>
<span class="sd">            onclick=&quot;with (this.firstChild.style)</span>
<span class="sd">                     { display = (display == &#39;&#39;) ? &#39;none&#39; : &#39;&#39; }&quot;&gt;</span>
<span class="sd">            &lt;pre&gt;1</span>
<span class="sd">            2&lt;/pre&gt;</span>
<span class="sd">          &lt;/td&gt;</span>
<span class="sd">          &lt;td class=&quot;code&quot;&gt;</span>
<span class="sd">            &lt;pre&gt;&lt;span class=&quot;Ke&quot;&gt;def &lt;/span&gt;&lt;span class=&quot;NaFu&quot;&gt;foo&lt;/span&gt;(bar):</span>
<span class="sd">              &lt;span class=&quot;Ke&quot;&gt;pass&lt;/span&gt;</span>
<span class="sd">            &lt;/pre&gt;</span>
<span class="sd">          &lt;/td&gt;</span>
<span class="sd">        &lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</span>

<span class="sd">    (whitespace added to improve clarity).</span>

<span class="sd">    Wrapping can be disabled using the `nowrap` option.</span>

<span class="sd">    A list of lines can be specified using the `hl_lines` option to make these</span>
<span class="sd">    lines highlighted (as of Pygments 0.11).</span>

<span class="sd">    With the `full` option, a complete HTML 4 document is output, including</span>
<span class="sd">    the style definitions inside a ``&lt;style&gt;`` tag, or in a separate file if</span>
<span class="sd">    the `cssfile` option is given.</span>

<span class="sd">    When `tagsfile` is set to the path of a ctags index file, it is used to</span>
<span class="sd">    generate hyperlinks from names to their definition.  You must enable</span>
<span class="sd">    `anchorlines` and run ctags with the `-n` option for this to work.  The</span>
<span class="sd">    `python-ctags` module from PyPI must be installed to use this feature;</span>
<span class="sd">    otherwise a `RuntimeError` will be raised.</span>

<span class="sd">    The `get_style_defs(arg=&#39;&#39;)` method of a `HtmlFormatter` returns a string</span>
<span class="sd">    containing CSS rules for the CSS classes used by the formatter. The</span>
<span class="sd">    argument `arg` can be used to specify additional CSS selectors that</span>
<span class="sd">    are prepended to the classes. A call `fmter.get_style_defs(&#39;td .code&#39;)`</span>
<span class="sd">    would result in the following CSS classes:</span>

<span class="sd">    .. sourcecode:: css</span>

<span class="sd">        td .code .kw { font-weight: bold; color: #00FF00 }</span>
<span class="sd">        td .code .cm { color: #999999 }</span>
<span class="sd">        ...</span>

<span class="sd">    If you have Pygments 0.6 or higher, you can also pass a list or tuple to the</span>
<span class="sd">    `get_style_defs()` method to request multiple prefixes for the tokens:</span>

<span class="sd">    .. sourcecode:: python</span>

<span class="sd">        formatter.get_style_defs([&#39;div.syntax pre&#39;, &#39;pre.syntax&#39;])</span>

<span class="sd">    The output would then look like this:</span>

<span class="sd">    .. sourcecode:: css</span>

<span class="sd">        div.syntax pre .kw,</span>
<span class="sd">        pre.syntax .kw { font-weight: bold; color: #00FF00 }</span>
<span class="sd">        div.syntax pre .cm,</span>
<span class="sd">        pre.syntax .cm { color: #999999 }</span>
<span class="sd">        ...</span>

<span class="sd">    Additional options accepted:</span>

<span class="sd">    `nowrap`</span>
<span class="sd">        If set to ``True``, don&#39;t wrap the tokens at all, not even inside a ``&lt;pre&gt;``</span>
<span class="sd">        tag. This disables most other options (default: ``False``).</span>

<span class="sd">    `full`</span>
<span class="sd">        Tells the formatter to output a &quot;full&quot; document, i.e. a complete</span>
<span class="sd">        self-contained document (default: ``False``).</span>

<span class="sd">    `title`</span>
<span class="sd">        If `full` is true, the title that should be used to caption the</span>
<span class="sd">        document (default: ``&#39;&#39;``).</span>

<span class="sd">    `style`</span>
<span class="sd">        The style to use, can be a string or a Style subclass (default:</span>
<span class="sd">        ``&#39;default&#39;``). This option has no effect if the `cssfile`</span>
<span class="sd">        and `noclobber_cssfile` option are given and the file specified in</span>
<span class="sd">        `cssfile` exists.</span>

<span class="sd">    `noclasses`</span>
<span class="sd">        If set to true, token ``&lt;span&gt;`` tags will not use CSS classes, but</span>
<span class="sd">        inline styles. This is not recommended for larger pieces of code since</span>
<span class="sd">        it increases output size by quite a bit (default: ``False``).</span>

<span class="sd">    `classprefix`</span>
<span class="sd">        Since the token types use relatively short class names, they may clash</span>
<span class="sd">        with some of your own class names. In this case you can use the</span>
<span class="sd">        `classprefix` option to give a string to prepend to all Pygments-generated</span>
<span class="sd">        CSS class names for token types.</span>
<span class="sd">        Note that this option also affects the output of `get_style_defs()`.</span>

<span class="sd">    `cssclass`</span>
<span class="sd">        CSS class for the wrapping ``&lt;div&gt;`` tag (default: ``&#39;highlight&#39;``).</span>
<span class="sd">        If you set this option, the default selector for `get_style_defs()`</span>
<span class="sd">        will be this class.</span>

<span class="sd">        *New in Pygments 0.9:* If you select the ``&#39;table&#39;`` line numbers, the</span>
<span class="sd">        wrapping table will have a CSS class of this string plus ``&#39;table&#39;``,</span>
<span class="sd">        the default is accordingly ``&#39;highlighttable&#39;``.</span>

<span class="sd">    `cssstyles`</span>
<span class="sd">        Inline CSS styles for the wrapping ``&lt;div&gt;`` tag (default: ``&#39;&#39;``).</span>

<span class="sd">    `prestyles`</span>
<span class="sd">        Inline CSS styles for the ``&lt;pre&gt;`` tag (default: ``&#39;&#39;``).  *New in</span>
<span class="sd">        Pygments 0.11.*</span>

<span class="sd">    `cssfile`</span>
<span class="sd">        If the `full` option is true and this option is given, it must be the</span>
<span class="sd">        name of an external file. If the filename does not include an absolute</span>
<span class="sd">        path, the file&#39;s path will be assumed to be relative to the main output</span>
<span class="sd">        file&#39;s path, if the latter can be found. The stylesheet is then written</span>
<span class="sd">        to this file instead of the HTML file. *New in Pygments 0.6.*</span>

<span class="sd">    `noclobber_cssfile`</span>
<span class="sd">        If `cssfile` is given and the specified file exists, the css file will</span>
<span class="sd">        not be overwritten. This allows the use of the `full` option in</span>
<span class="sd">        combination with a user specified css file. Default is ``False``.</span>
<span class="sd">        *New in Pygments 1.1.*</span>

<span class="sd">    `linenos`</span>
<span class="sd">        If set to ``&#39;table&#39;``, output line numbers as a table with two cells,</span>
<span class="sd">        one containing the line numbers, the other the whole code.  This is</span>
<span class="sd">        copy-and-paste-friendly, but may cause alignment problems with some</span>
<span class="sd">        browsers or fonts.  If set to ``&#39;inline&#39;``, the line numbers will be</span>
<span class="sd">        integrated in the ``&lt;pre&gt;`` tag that contains the code (that setting</span>
<span class="sd">        is *new in Pygments 0.8*).</span>

<span class="sd">        For compatibility with Pygments 0.7 and earlier, every true value</span>
<span class="sd">        except ``&#39;inline&#39;`` means the same as ``&#39;table&#39;`` (in particular, that</span>
<span class="sd">        means also ``True``).</span>

<span class="sd">        The default value is ``False``, which means no line numbers at all.</span>

<span class="sd">        **Note:** with the default (&quot;table&quot;) line number mechanism, the line</span>
<span class="sd">        numbers and code can have different line heights in Internet Explorer</span>
<span class="sd">        unless you give the enclosing ``&lt;pre&gt;`` tags an explicit ``line-height``</span>
<span class="sd">        CSS property (you get the default line spacing with ``line-height:</span>
<span class="sd">        125%``).</span>

<span class="sd">    `hl_lines`</span>
<span class="sd">        Specify a list of lines to be highlighted.  *New in Pygments 0.11.*</span>

<span class="sd">    `linenostart`</span>
<span class="sd">        The line number for the first line (default: ``1``).</span>

<span class="sd">    `linenostep`</span>
<span class="sd">        If set to a number n &gt; 1, only every nth line number is printed.</span>

<span class="sd">    `linenospecial`</span>
<span class="sd">        If set to a number n &gt; 0, every nth line number is given the CSS</span>
<span class="sd">        class ``&quot;special&quot;`` (default: ``0``).</span>

<span class="sd">    `nobackground`</span>
<span class="sd">        If set to ``True``, the formatter won&#39;t output the background color</span>
<span class="sd">        for the wrapping element (this automatically defaults to ``False``</span>
<span class="sd">        when there is no wrapping element [eg: no argument for the</span>
<span class="sd">        `get_syntax_defs` method given]) (default: ``False``). *New in</span>
<span class="sd">        Pygments 0.6.*</span>

<span class="sd">    `lineseparator`</span>
<span class="sd">        This string is output between lines of code. It defaults to ``&quot;\n&quot;``,</span>
<span class="sd">        which is enough to break a line inside ``&lt;pre&gt;`` tags, but you can</span>
<span class="sd">        e.g. set it to ``&quot;&lt;br&gt;&quot;`` to get HTML line breaks. *New in Pygments</span>
<span class="sd">        0.7.*</span>

<span class="sd">    `lineanchors`</span>
<span class="sd">        If set to a nonempty string, e.g. ``foo``, the formatter will wrap each</span>
<span class="sd">        output line in an anchor tag with a ``name`` of ``foo-linenumber``.</span>
<span class="sd">        This allows easy linking to certain lines. *New in Pygments 0.9.*</span>

<span class="sd">    `linespans`</span>
<span class="sd">        If set to a nonempty string, e.g. ``foo``, the formatter will wrap each</span>
<span class="sd">        output line in a span tag with an ``id`` of ``foo-linenumber``.</span>
<span class="sd">        This allows easy access to lines via javascript. *New in Pygments 1.6.*</span>

<span class="sd">    `anchorlinenos`</span>
<span class="sd">        If set to `True`, will wrap line numbers in &lt;a&gt; tags. Used in</span>
<span class="sd">        combination with `linenos` and `lineanchors`.</span>

<span class="sd">    `tagsfile`</span>
<span class="sd">        If set to the path of a ctags file, wrap names in anchor tags that</span>
<span class="sd">        link to their definitions. `lineanchors` should be used, and the</span>
<span class="sd">        tags file should specify line numbers (see the `-n` option to ctags).</span>
<span class="sd">        *New in Pygments 1.6.*</span>

<span class="sd">    `tagurlformat`</span>
<span class="sd">        A string formatting pattern used to generate links to ctags definitions.</span>
<span class="sd">        Available variables are `%(path)s`, `%(fname)s` and `%(fext)s`.</span>
<span class="sd">        Defaults to an empty string, resulting in just `#prefix-number` links.</span>
<span class="sd">        *New in Pygments 1.6.*</span>


<span class="sd">    **Subclassing the HTML formatter**</span>

<span class="sd">    *New in Pygments 0.7.*</span>

<span class="sd">    The HTML formatter is now built in a way that allows easy subclassing, thus</span>
<span class="sd">    customizing the output HTML code. The `format()` method calls</span>
<span class="sd">    `self._format_lines()` which returns a generator that yields tuples of ``(1,</span>
<span class="sd">    line)``, where the ``1`` indicates that the ``line`` is a line of the</span>
<span class="sd">    formatted source code.</span>

<span class="sd">    If the `nowrap` option is set, the generator is the iterated over and the</span>
<span class="sd">    resulting HTML is output.</span>

<span class="sd">    Otherwise, `format()` calls `self.wrap()`, which wraps the generator with</span>
<span class="sd">    other generators. These may add some HTML code to the one generated by</span>
<span class="sd">    `_format_lines()`, either by modifying the lines generated by the latter,</span>
<span class="sd">    then yielding them again with ``(1, line)``, and/or by yielding other HTML</span>
<span class="sd">    code before or after the lines, with ``(0, html)``. The distinction between</span>
<span class="sd">    source lines and other code makes it possible to wrap the generator multiple</span>
<span class="sd">    times.</span>

<span class="sd">    The default `wrap()` implementation adds a ``&lt;div&gt;`` and a ``&lt;pre&gt;`` tag.</span>

<span class="sd">    A custom `HtmlFormatter` subclass could look like this:</span>

<span class="sd">    .. sourcecode:: python</span>

<span class="sd">        class CodeHtmlFormatter(HtmlFormatter):</span>

<span class="sd">            def wrap(self, source, outfile):</span>
<span class="sd">                return self._wrap_code(source)</span>

<span class="sd">            def _wrap_code(self, source):</span>
<span class="sd">                yield 0, &#39;&lt;code&gt;&#39;</span>
<span class="sd">                for i, t in source:</span>
<span class="sd">                    if i == 1:</span>
<span class="sd">                        # it&#39;s a line of formatted code</span>
<span class="sd">                        t += &#39;&lt;br&gt;&#39;</span>
<span class="sd">                    yield i, t</span>
<span class="sd">                yield 0, &#39;&lt;/code&gt;&#39;</span>

<span class="sd">    This results in wrapping the formatted lines with a ``&lt;code&gt;`` tag, where the</span>
<span class="sd">    source lines are broken using ``&lt;br&gt;`` tags.</span>

<span class="sd">    After calling `wrap()`, the `format()` method also adds the &quot;line numbers&quot;</span>
<span class="sd">    and/or &quot;full document&quot; wrappers if the respective options are set. Then, all</span>
<span class="sd">    HTML yielded by the wrapped generator is output.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;HTML&#39;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;html&#39;</span><span class="p">]</span>
    <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;*.html&#39;</span><span class="p">,</span> <span class="s">&#39;*.htm&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="n">Formatter</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decodeifneeded</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nowrap</span> <span class="o">=</span> <span class="n">get_bool_opt</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s">&#39;nowrap&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noclasses</span> <span class="o">=</span> <span class="n">get_bool_opt</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s">&#39;noclasses&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classprefix</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;classprefix&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cssclass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decodeifneeded</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;cssclass&#39;</span><span class="p">,</span> <span class="s">&#39;highlight&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cssstyles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decodeifneeded</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;cssstyles&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prestyles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decodeifneeded</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;prestyles&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cssfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decodeifneeded</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;cssfile&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noclobber_cssfile</span> <span class="o">=</span> <span class="n">get_bool_opt</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s">&#39;noclobber_cssfile&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tagsfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decodeifneeded</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;tagsfile&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tagurlformat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decodeifneeded</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;tagurlformat&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tagsfile</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ctags</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;The &quot;ctags&quot; package must to be installed &#39;</span>
                                   <span class="s">&#39;to be able to use the &quot;tagsfile&quot; feature.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ctags</span> <span class="o">=</span> <span class="n">ctags</span><span class="o">.</span><span class="n">CTags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tagsfile</span><span class="p">)</span>

        <span class="n">linenos</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;linenos&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">linenos</span> <span class="o">==</span> <span class="s">&#39;inline&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">linenos</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">linenos</span><span class="p">:</span>
            <span class="c"># compatibility with &lt;= 0.7</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">linenos</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">linenos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linenostart</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">get_int_opt</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s">&#39;linenostart&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linenostep</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">get_int_opt</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s">&#39;linenostep&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linenospecial</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">get_int_opt</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s">&#39;linenospecial&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nobackground</span> <span class="o">=</span> <span class="n">get_bool_opt</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s">&#39;nobackground&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineseparator</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;lineseparator&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineanchors</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;lineanchors&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linespans</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;linespans&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchorlinenos</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;anchorlinenos&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hl_lines</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">lineno</span> <span class="ow">in</span> <span class="n">get_list_opt</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s">&#39;hl_lines&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hl_lines</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lineno</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_create_stylesheet</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_css_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ttype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the css class of this token type prefixed with</span>
<span class="sd">        the classprefix option.&quot;&quot;&quot;</span>
        <span class="n">ttypeclass</span> <span class="o">=</span> <span class="n">_get_ttype_class</span><span class="p">(</span><span class="n">ttype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ttypeclass</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">classprefix</span> <span class="o">+</span> <span class="n">ttypeclass</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">_create_stylesheet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t2c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttype2class</span> <span class="o">=</span> <span class="p">{</span><span class="n">Token</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">}</span>
        <span class="n">c2s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">class2style</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ttype</span><span class="p">,</span> <span class="n">ndef</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_css_class</span><span class="p">(</span><span class="n">ttype</span><span class="p">)</span>
            <span class="n">style</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">ndef</span><span class="p">[</span><span class="s">&#39;color&#39;</span><span class="p">]:</span>
                <span class="n">style</span> <span class="o">+=</span> <span class="s">&#39;color: #</span><span class="si">%s</span><span class="s">; &#39;</span> <span class="o">%</span> <span class="n">ndef</span><span class="p">[</span><span class="s">&#39;color&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ndef</span><span class="p">[</span><span class="s">&#39;bold&#39;</span><span class="p">]:</span>
                <span class="n">style</span> <span class="o">+=</span> <span class="s">&#39;font-weight: bold; &#39;</span>
            <span class="k">if</span> <span class="n">ndef</span><span class="p">[</span><span class="s">&#39;italic&#39;</span><span class="p">]:</span>
                <span class="n">style</span> <span class="o">+=</span> <span class="s">&#39;font-style: italic; &#39;</span>
            <span class="k">if</span> <span class="n">ndef</span><span class="p">[</span><span class="s">&#39;underline&#39;</span><span class="p">]:</span>
                <span class="n">style</span> <span class="o">+=</span> <span class="s">&#39;text-decoration: underline; &#39;</span>
            <span class="k">if</span> <span class="n">ndef</span><span class="p">[</span><span class="s">&#39;bgcolor&#39;</span><span class="p">]:</span>
                <span class="n">style</span> <span class="o">+=</span> <span class="s">&#39;background-color: #</span><span class="si">%s</span><span class="s">; &#39;</span> <span class="o">%</span> <span class="n">ndef</span><span class="p">[</span><span class="s">&#39;bgcolor&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ndef</span><span class="p">[</span><span class="s">&#39;border&#39;</span><span class="p">]:</span>
                <span class="n">style</span> <span class="o">+=</span> <span class="s">&#39;border: 1px solid #</span><span class="si">%s</span><span class="s">; &#39;</span> <span class="o">%</span> <span class="n">ndef</span><span class="p">[</span><span class="s">&#39;border&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">style</span><span class="p">:</span>
                <span class="n">t2c</span><span class="p">[</span><span class="n">ttype</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
                <span class="c"># save len(ttype) to enable ordering the styles by</span>
                <span class="c"># hierarchy (necessary for CSS cascading rules!)</span>
                <span class="n">c2s</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">style</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">ttype</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ttype</span><span class="p">))</span>

<div class="viewcode-block" id="HtmlFormatter.get_style_defs"><a class="viewcode-back" href="../../../formatters/html.html#pygments.formatters.html.HtmlFormatter.get_style_defs">[docs]</a>    <span class="k">def</span> <span class="nf">get_style_defs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return CSS style definitions for the classes produced by the current</span>
<span class="sd">        highlighting style. ``arg`` can be a string or list of selectors to</span>
<span class="sd">        insert before the token type classes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;cssclass&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="ow">and</span> <span class="s">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">cssclass</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">arg</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">prefix</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cls</span><span class="p">:</span>
                <span class="n">cls</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">cls</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">arg</span> <span class="ow">and</span> <span class="n">arg</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">cls</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

        <span class="n">styles</span> <span class="o">=</span> <span class="p">[(</span><span class="n">level</span><span class="p">,</span> <span class="n">ttype</span><span class="p">,</span> <span class="n">cls</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
                  <span class="k">for</span> <span class="n">cls</span><span class="p">,</span> <span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="n">ttype</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">class2style</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span>
                  <span class="k">if</span> <span class="n">cls</span> <span class="ow">and</span> <span class="n">style</span><span class="p">]</span>
        <span class="n">styles</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> { </span><span class="si">%s</span><span class="s"> } /* </span><span class="si">%s</span><span class="s"> */&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">(</span><span class="n">cls</span><span class="p">),</span> <span class="n">style</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">ttype</span><span class="p">)[</span><span class="mi">6</span><span class="p">:])</span>
                 <span class="k">for</span> <span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">ttype</span><span class="p">,</span> <span class="n">cls</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span> <span class="ow">in</span> <span class="n">styles</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">arg</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nobackground</span> <span class="ow">and</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">text_style</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">Text</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttype2class</span><span class="p">:</span>
                <span class="n">text_style</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">class2style</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ttype2class</span><span class="p">[</span><span class="n">Text</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> { background: </span><span class="si">%s</span><span class="s">;</span><span class="si">%s</span><span class="s"> }&#39;</span> <span class="o">%</span>
                         <span class="p">(</span><span class="n">prefix</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_color</span><span class="p">,</span> <span class="n">text_style</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">highlight_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.hll { background-color: </span><span class="si">%s</span><span class="s"> }&#39;</span> <span class="o">%</span>
                         <span class="p">(</span><span class="n">prefix</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">highlight_color</span><span class="p">))</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_decodeifneeded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_wrap_full</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inner</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cssfile</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cssfile</span><span class="p">):</span>
                <span class="c"># it&#39;s an absolute filename</span>
                <span class="n">cssfilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cssfile</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">outfile</span><span class="o">.</span><span class="n">name</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span> <span class="ow">or</span> <span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;&lt;&#39;</span><span class="p">:</span>
                        <span class="c"># pseudo files, e.g. name == &#39;&lt;fdopen&gt;&#39;</span>
                        <span class="k">raise</span> <span class="ne">AttributeError</span>
                    <span class="n">cssfilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">cssfile</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#39;Note: Cannot determine output file name, &#39;</span> \
                          <span class="s">&#39;using current directory as base for the CSS file name&#39;</span>
                    <span class="n">cssfilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cssfile</span>
            <span class="c"># write CSS file only if noclobber_cssfile isn&#39;t given as an option.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cssfilename</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">noclobber_cssfile</span><span class="p">:</span>
                    <span class="n">cf</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">cssfilename</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
                    <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">CSSFILE_TEMPLATE</span> <span class="o">%</span>
                            <span class="p">{</span><span class="s">&#39;styledefs&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_style_defs</span><span class="p">(</span><span class="s">&#39;body&#39;</span><span class="p">)})</span>
                    <span class="n">cf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">err</span><span class="o">.</span><span class="n">strerror</span> <span class="o">=</span> <span class="s">&#39;Error writing CSS file: &#39;</span> <span class="o">+</span> <span class="n">err</span><span class="o">.</span><span class="n">strerror</span>
                <span class="k">raise</span>

            <span class="k">yield</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">DOC_HEADER_EXTERNALCSS</span> <span class="o">%</span>
                      <span class="nb">dict</span><span class="p">(</span><span class="n">title</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                           <span class="n">cssfile</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cssfile</span><span class="p">,</span>
                           <span class="n">encoding</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">DOC_HEADER</span> <span class="o">%</span>
                      <span class="nb">dict</span><span class="p">(</span><span class="n">title</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                           <span class="n">styledefs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_style_defs</span><span class="p">(</span><span class="s">&#39;body&#39;</span><span class="p">),</span>
                           <span class="n">encoding</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">inner</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">t</span><span class="p">,</span> <span class="n">line</span>
        <span class="k">yield</span> <span class="mi">0</span><span class="p">,</span> <span class="n">DOC_FOOTER</span>

    <span class="k">def</span> <span class="nf">_wrap_tablelinenos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inner</span><span class="p">):</span>
        <span class="n">dummyoutfile</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="n">lncount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">inner</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">lncount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">dummyoutfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="n">fl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linenostart</span>
        <span class="n">mw</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lncount</span> <span class="o">+</span> <span class="n">fl</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linenospecial</span>
        <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linenostep</span>
        <span class="n">la</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineanchors</span>
        <span class="n">aln</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchorlinenos</span>
        <span class="n">nocls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noclasses</span>
        <span class="k">if</span> <span class="n">sp</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">fl</span><span class="o">+</span><span class="n">lncount</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">st</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">sp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">aln</span><span class="p">:</span>
                            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;#</span><span class="si">%s</span><span class="s">-</span><span class="si">%d</span><span class="s">&quot; class=&quot;special&quot;&gt;</span><span class="si">%*d</span><span class="s">&lt;/a&gt;&#39;</span> <span class="o">%</span>
                                         <span class="p">(</span><span class="n">la</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">mw</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&lt;span class=&quot;special&quot;&gt;</span><span class="si">%*d</span><span class="s">&lt;/span&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mw</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">aln</span><span class="p">:</span>
                            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;#</span><span class="si">%s</span><span class="s">-</span><span class="si">%d</span><span class="s">&quot;&gt;</span><span class="si">%*d</span><span class="s">&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">la</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">mw</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%*d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mw</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">fl</span><span class="o">+</span><span class="n">lncount</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">st</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">aln</span><span class="p">:</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;#</span><span class="si">%s</span><span class="s">-</span><span class="si">%d</span><span class="s">&quot;&gt;</span><span class="si">%*d</span><span class="s">&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">la</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">mw</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%*d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mw</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

        <span class="c"># in case you wonder about the seemingly redundant &lt;div&gt; here: since the</span>
        <span class="c"># content in the other cell also is wrapped in a div, some browsers in</span>
        <span class="c"># some configurations seem to mess up the formatting...</span>
        <span class="k">if</span> <span class="n">nocls</span><span class="p">:</span>
            <span class="k">yield</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;&lt;table class=&quot;</span><span class="si">%s</span><span class="s">table&quot;&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">cssclass</span> <span class="o">+</span>
                      <span class="s">&#39;&lt;tr&gt;&lt;td&gt;&lt;div class=&quot;linenodiv&quot; &#39;</span>
                      <span class="s">&#39;style=&quot;background-color: #f0f0f0; padding-right: 10px&quot;&gt;&#39;</span>
                      <span class="s">&#39;&lt;pre style=&quot;line-height: 125%&quot;&gt;&#39;</span> <span class="o">+</span>
                      <span class="n">ls</span> <span class="o">+</span> <span class="s">&#39;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;&lt;table class=&quot;</span><span class="si">%s</span><span class="s">table&quot;&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">cssclass</span> <span class="o">+</span>
                      <span class="s">&#39;&lt;tr&gt;&lt;td class=&quot;linenos&quot;&gt;&lt;div class=&quot;linenodiv&quot;&gt;&lt;pre&gt;&#39;</span> <span class="o">+</span>
                      <span class="n">ls</span> <span class="o">+</span> <span class="s">&#39;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dummyoutfile</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="k">yield</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#39;</span>

    <span class="k">def</span> <span class="nf">_wrap_inlinelinenos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inner</span><span class="p">):</span>
        <span class="c"># need a list of lines since we need the width of a single number :(</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inner</span><span class="p">)</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linenospecial</span>
        <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linenostep</span>
        <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linenostart</span>
        <span class="n">mw</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="n">num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noclasses</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sp</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">num</span><span class="o">%</span><span class="n">sp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">style</span> <span class="o">=</span> <span class="s">&#39;background-color: #ffffc0; padding: 0 5px 0 5px&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">style</span> <span class="o">=</span> <span class="s">&#39;background-color: #f0f0f0; padding: 0 5px 0 5px&#39;</span>
                    <span class="k">yield</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;&lt;span style=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;</span><span class="si">%*s</span><span class="s">&lt;/span&gt; &#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">style</span><span class="p">,</span> <span class="n">mw</span><span class="p">,</span> <span class="p">(</span><span class="n">num</span><span class="o">%</span><span class="n">st</span> <span class="ow">and</span> <span class="s">&#39; &#39;</span> <span class="ow">or</span> <span class="n">num</span><span class="p">))</span> <span class="o">+</span> <span class="n">line</span>
                    <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;&lt;span style=&quot;background-color: #f0f0f0; &#39;</span>
                              <span class="s">&#39;padding: 0 5px 0 5px&quot;&gt;</span><span class="si">%*s</span><span class="s">&lt;/span&gt; &#39;</span> <span class="o">%</span> <span class="p">(</span>
                              <span class="n">mw</span><span class="p">,</span> <span class="p">(</span><span class="n">num</span><span class="o">%</span><span class="n">st</span> <span class="ow">and</span> <span class="s">&#39; &#39;</span> <span class="ow">or</span> <span class="n">num</span><span class="p">))</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
                    <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">sp</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">yield</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;&lt;span class=&quot;lineno</span><span class="si">%s</span><span class="s">&quot;&gt;</span><span class="si">%*s</span><span class="s">&lt;/span&gt; &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">num</span><span class="o">%</span><span class="n">sp</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s">&#39; special&#39;</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">mw</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">num</span><span class="o">%</span><span class="n">st</span> <span class="ow">and</span> <span class="s">&#39; &#39;</span> <span class="ow">or</span> <span class="n">num</span><span class="p">))</span> <span class="o">+</span> <span class="n">line</span>
                <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">yield</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;&lt;span class=&quot;lineno&quot;&gt;</span><span class="si">%*s</span><span class="s">&lt;/span&gt; &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">mw</span><span class="p">,</span> <span class="p">(</span><span class="n">num</span><span class="o">%</span><span class="n">st</span> <span class="ow">and</span> <span class="s">&#39; &#39;</span> <span class="ow">or</span> <span class="n">num</span><span class="p">))</span> <span class="o">+</span> <span class="n">line</span>
                <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_wrap_lineanchors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inner</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineanchors</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linenostart</span> <span class="o">-</span> <span class="mi">1</span> <span class="c"># subtract 1 since we have to increment i</span>
                                 <span class="c"># *before* yielding</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">inner</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">yield</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;&lt;a name=&quot;</span><span class="si">%s</span><span class="s">-</span><span class="si">%d</span><span class="s">&quot;&gt;&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">line</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="mi">0</span><span class="p">,</span> <span class="n">line</span>

    <span class="k">def</span> <span class="nf">_wrap_linespans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inner</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linespans</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linenostart</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">inner</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">yield</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;&lt;span id=&quot;</span><span class="si">%s</span><span class="s">-</span><span class="si">%d</span><span class="s">&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/span&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="mi">0</span><span class="p">,</span> <span class="n">line</span>

    <span class="k">def</span> <span class="nf">_wrap_div</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inner</span><span class="p">):</span>
        <span class="n">style</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noclasses</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nobackground</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">style</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;background: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_color</span><span class="p">,))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cssstyles</span><span class="p">:</span>
            <span class="n">style</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cssstyles</span><span class="p">)</span>
        <span class="n">style</span> <span class="o">=</span> <span class="s">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>

        <span class="k">yield</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;&lt;div&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cssclass</span> <span class="ow">and</span> <span class="s">&#39; class=&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">cssclass</span><span class="p">)</span>
                  <span class="o">+</span> <span class="p">(</span><span class="n">style</span> <span class="ow">and</span> <span class="p">(</span><span class="s">&#39; style=&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">style</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39;&gt;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">inner</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">tup</span>
        <span class="k">yield</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;&lt;/div&gt;</span><span class="se">\n</span><span class="s">&#39;</span>

    <span class="k">def</span> <span class="nf">_wrap_pre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inner</span><span class="p">):</span>
        <span class="n">style</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prestyles</span><span class="p">:</span>
            <span class="n">style</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prestyles</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noclasses</span><span class="p">:</span>
            <span class="n">style</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;line-height: 125%&#39;</span><span class="p">)</span>
        <span class="n">style</span> <span class="o">=</span> <span class="s">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>

        <span class="k">yield</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;&lt;pre&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="n">style</span> <span class="ow">and</span> <span class="s">&#39; style=&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">style</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;&gt;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">inner</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">tup</span>
        <span class="k">yield</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;&lt;/pre&gt;&#39;</span>

    <span class="k">def</span> <span class="nf">_format_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokensource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Just format the tokens, without any wrapping tags.</span>
<span class="sd">        Yield individual lines.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nocls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noclasses</span>
        <span class="n">lsep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineseparator</span>
        <span class="c"># for &lt;span style=&quot;&quot;&gt; lookup only</span>
        <span class="n">getcls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttype2class</span><span class="o">.</span><span class="n">get</span>
        <span class="n">c2s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">class2style</span>
        <span class="n">escape_table</span> <span class="o">=</span> <span class="n">_escape_html_table</span>
        <span class="n">tagsfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tagsfile</span>

        <span class="n">lspan</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">ttype</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">tokensource</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nocls</span><span class="p">:</span>
                <span class="n">cclass</span> <span class="o">=</span> <span class="n">getcls</span><span class="p">(</span><span class="n">ttype</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">cclass</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">ttype</span> <span class="o">=</span> <span class="n">ttype</span><span class="o">.</span><span class="n">parent</span>
                    <span class="n">cclass</span> <span class="o">=</span> <span class="n">getcls</span><span class="p">(</span><span class="n">ttype</span><span class="p">)</span>
                <span class="n">cspan</span> <span class="o">=</span> <span class="n">cclass</span> <span class="ow">and</span> <span class="s">&#39;&lt;span style=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="n">c2s</span><span class="p">[</span><span class="n">cclass</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_css_class</span><span class="p">(</span><span class="n">ttype</span><span class="p">)</span>
                <span class="n">cspan</span> <span class="o">=</span> <span class="n">cls</span> <span class="ow">and</span> <span class="s">&#39;&lt;span class=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="n">cls</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>

            <span class="n">parts</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">escape_table</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">tagsfile</span> <span class="ow">and</span> <span class="n">ttype</span> <span class="ow">in</span> <span class="n">Token</span><span class="o">.</span><span class="n">Name</span><span class="p">:</span>
                <span class="n">filename</span><span class="p">,</span> <span class="n">linenumber</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lookup_ctag</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">linenumber</span><span class="p">:</span>
                    <span class="n">base</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">base</span><span class="p">:</span>
                        <span class="n">base</span> <span class="o">+=</span> <span class="s">&#39;/&#39;</span>
                    <span class="n">filename</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tagurlformat</span> <span class="o">%</span> <span class="p">{</span><span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="n">base</span><span class="p">,</span> <span class="s">&#39;fname&#39;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
                                               <span class="s">&#39;fext&#39;</span><span class="p">:</span> <span class="n">extension</span><span class="p">}</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;&lt;a href=</span><span class="se">\&quot;</span><span class="si">%s</span><span class="s">#</span><span class="si">%s</span><span class="s">-</span><span class="si">%d</span><span class="se">\&quot;</span><span class="s">&gt;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
                        <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineanchors</span><span class="p">,</span> <span class="n">linenumber</span><span class="p">,</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&lt;/a&gt;&quot;</span>

            <span class="c"># for all but the last line</span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">lspan</span> <span class="o">!=</span> <span class="n">cspan</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span><span class="n">lspan</span> <span class="ow">and</span> <span class="s">&#39;&lt;/span&gt;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">cspan</span> <span class="o">+</span> <span class="n">part</span> <span class="o">+</span> \
                                <span class="p">(</span><span class="n">cspan</span> <span class="ow">and</span> <span class="s">&#39;&lt;/span&gt;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">lsep</span>
                    <span class="k">else</span><span class="p">:</span> <span class="c"># both are the same</span>
                        <span class="n">line</span> <span class="o">+=</span> <span class="n">part</span> <span class="o">+</span> <span class="p">(</span><span class="n">lspan</span> <span class="ow">and</span> <span class="s">&#39;&lt;/span&gt;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">lsep</span>
                    <span class="k">yield</span> <span class="mi">1</span><span class="p">,</span> <span class="n">line</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="k">elif</span> <span class="n">part</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cspan</span> <span class="o">+</span> <span class="n">part</span> <span class="o">+</span> <span class="p">(</span><span class="n">cspan</span> <span class="ow">and</span> <span class="s">&#39;&lt;/span&gt;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">lsep</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lsep</span>
            <span class="c"># for the last line</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">lspan</span> <span class="o">!=</span> <span class="n">cspan</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span><span class="n">lspan</span> <span class="ow">and</span> <span class="s">&#39;&lt;/span&gt;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">cspan</span> <span class="o">+</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">lspan</span> <span class="o">=</span> <span class="n">cspan</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">cspan</span> <span class="o">+</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">lspan</span> <span class="o">=</span> <span class="n">cspan</span>
            <span class="c"># else we neither have to open a new span nor set lspan</span>

        <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">yield</span> <span class="mi">1</span><span class="p">,</span> <span class="n">line</span> <span class="o">+</span> <span class="p">(</span><span class="n">lspan</span> <span class="ow">and</span> <span class="s">&#39;&lt;/span&gt;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">lsep</span>

    <span class="k">def</span> <span class="nf">_lookup_ctag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="n">ctags</span><span class="o">.</span><span class="n">TagEntry</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctags</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">entry</span><span class="p">[</span><span class="s">&#39;file&#39;</span><span class="p">],</span> <span class="n">entry</span><span class="p">[</span><span class="s">&#39;lineNumber&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_highlight_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokensource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Highlighted the lines specified in the `hl_lines` option by</span>
<span class="sd">        post-processing the token stream coming from `_format_lines`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hl_lines</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tokensource</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">t</span><span class="p">,</span> <span class="n">value</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">hls</span><span class="p">:</span> <span class="c"># i + 1 because Python indexes start at 0</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noclasses</span><span class="p">:</span>
                    <span class="n">style</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">highlight_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">style</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39; style=&quot;background-color: </span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">highlight_color</span><span class="p">,))</span>
                    <span class="k">yield</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;&lt;span</span><span class="si">%s</span><span class="s">&gt;</span><span class="si">%s</span><span class="s">&lt;/span&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;&lt;span class=&quot;hll&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/span&gt;&#39;</span> <span class="o">%</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="mi">1</span><span class="p">,</span> <span class="n">value</span>

<div class="viewcode-block" id="HtmlFormatter.wrap"><a class="viewcode-back" href="../../../formatters/html.html#pygments.formatters.html.HtmlFormatter.wrap">[docs]</a>    <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrap the ``source``, which is a generator yielding</span>
<span class="sd">        individual lines, in custom generators. See docstring</span>
<span class="sd">        for `format`. Can be overridden.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_div</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrap_pre</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="HtmlFormatter.format_unencoded"><a class="viewcode-back" href="../../../formatters/html.html#pygments.formatters.html.HtmlFormatter.format_unencoded">[docs]</a>    <span class="k">def</span> <span class="nf">format_unencoded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokensource</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The formatting process uses several nested generators; which of</span>
<span class="sd">        them are used is determined by the user&#39;s options.</span>

<span class="sd">        Each generator should take at least one argument, ``inner``,</span>
<span class="sd">        and wrap the pieces of text generated by this.</span>

<span class="sd">        Always yield 2-tuples: (code, text). If &quot;code&quot; is 1, the text</span>
<span class="sd">        is part of the original tokensource being highlighted, if it&#39;s</span>
<span class="sd">        0, the text is some piece of wrapping. This makes it possible to</span>
<span class="sd">        use several different wrappers that process the original source</span>
<span class="sd">        linewise, e.g. line number generators.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_lines</span><span class="p">(</span><span class="n">tokensource</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hl_lines</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highlight_lines</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nowrap</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linenos</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_inlinelinenos</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineanchors</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_lineanchors</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linespans</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_linespans</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linenos</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_tablelinenos</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_full</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">piece</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">piece</span><span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">pygments-doc 1.1.3 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../pygments.html" >pygments</a> &raquo;</li>
          <li><a href="../formatters.html" >pygments.formatters</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Turbidsoul Chen.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>